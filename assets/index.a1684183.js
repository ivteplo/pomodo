var e=Object.defineProperty,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(t,o,s)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,a=(e,a)=>{for(var r in a||(a={}))o.call(a,r)&&n(e,r,a[r]);if(t)for(var r of t(a))s.call(a,r)&&n(e,r,a[r]);return e};import{o as r,c as i,a as l,F as u,r as c,t as d,n as m,p as f,b as p,d as g,e as h,w as k,f as b,m as v,g as y,T as w,h as S,i as L,j as B,v as D,k as P,l as T}from"./vendor.21c4ec5c.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const O={props:{time:String,isPaused:Boolean},setup:e=>(t,o)=>(r(),i("button",{class:m("column Timer "+(e.isPaused?"paused":"")),role:"status"},[l("h2",null,[(r(!0),i(u,null,c(Object.entries(e.time.split("")),(([e,t])=>(r(),i("span",{key:e+t},d(t),1)))),128))]),l("p",null,d(e.isPaused?"Paused":"Running"),1)],2)),__scopeId:"data-v-7f57b181"};const C={methods:{close(){this.$emit("close")}},emits:["close"],props:["isOpen"]};f("data-v-ec732a2c");const j={class:"modal column"},N={class:"row"},M=l("span",null,null,-1),U={class:"controls"};p(),C.render=function(e,t,o,s,n,a){return r(),g(S,{to:"#app-modals"},[h(w,{name:"fade"},{default:k((()=>[o.isOpen?(r(),i("div",v({key:0,class:"modal-wrapper column"},e.$attrs),[l("div",j,[l("header",N,[b(e.$slots,"header",{},(()=>[M]),{}),l("div",U,[l("button",{type:"button",role:"navigation",onClick:t[0]||(t[0]=e=>a.close())}," Close ")])]),l("main",null,[b(e.$slots,"body",{},void 0,!0)])]),l("div",{class:"modal-blur-background",onClick:t[1]||(t[1]=e=>a.close())})],16)):y("",!0)])),_:3})])},C.__scopeId="data-v-ec732a2c";function F(e){for(;e&&"/"===e[0];)e=e.substring(1);for(;e&&"/"===e[e.length-1];)e=e.slice(0,-1);return e}function I(...e){return 0===e.length?"":"/"+F(e.map((e=>F(e))).join("/"))}const E=I("/pomodo/","/serviceWorker.js");const x=I("/pomodo/","/timerWorker.js");function W(){return"Worker"in window?new Worker(x):function(){let e;function t(){"number"!=typeof e&&(e=setInterval(o,1e3),o())}function o(){r("tick")}function s(){"number"==typeof e&&clearInterval(e),e=void 0}function n(e){switch(e){case"startTimer":t();break;case"stopTimer":s();break;default:console.error("Unknown message: "+e)}}const a={};function r(e){var t;null==(t=a.message)||t.forEach((t=>{t({data:e})}))}return{addEventListener(e,t){e in a||(a[e]=[]),a[e].push(t)},postMessage(e){n(e)}}}()}const A={mode:"focus",streaksForLongBreak:4,streak:{time:Date.now(),length:0},durations:{focus:1500,shortBreak:300,longBreak:900}},_=["focus","shortBreak","longBreak"],$=e=>-1!==_.indexOf(e),R=e=>{if("object"!=typeof e.durations)e.durations=a({},A.durations);else{for(let[t,o]of Object.entries(e.durations))o=Math.round(o),$(t)?e.durations[t]="number"==typeof o&&o>=60&&o<=7200?o:A.durations[t]:delete e.durations[t];for(let t of _)t in e.durations||(e.durations[t]=A.durations[t])}return $(e.mode)||(e.mode="focus",e.timeLeft=e.durations.focus),"object"==typeof e.streak&&"number"==typeof e.streak.time&&"number"==typeof e.streak.length&&Date.now()-e.streak.time<=288e5||(e.streak=a({},A.streak)),"number"!=typeof e.streaksForLongBreak?e.streaksForLongBreak=A.streaksForLongBreak:e.streaksForLongBreak=Math.max(2,Math.min(8,e.streaksForLongBreak)),"number"==typeof e.timeLeft&&e.timeLeft>=0||(e.timeLeft=e.durations[e.mode]),e},V=e=>{e=R(a({},e)),localStorage.setItem("state",JSON.stringify(e))};const q={class:"column"},H=l("h1",null,"Pomodo",-1),J={class:"row status-buttons"},K=l("h2",null,"Settings",-1),z={class:"column settings"},G={class:"column setting"},Q=l("h3",null,"Focus timer duration (in minutes)",-1),X={class:"column setting"},Y=l("h3",null,"Short break duration (in minutes)",-1),Z={class:"column setting"},ee=l("h3",null,"Long break duration (in minutes)",-1),te=l("h2",null,"Update",-1),oe={class:"column"},se=l("p",{style:{"margin-bottom":"1rem"}}," There is an update available. It will be installed when all tabs for this page are closed. ",-1);const ne=e=>e>9?e.toString():"0"+e;var ae=L((()=>{const e=(()=>{const e=localStorage.getItem("state");if(!e)return a({},A);try{return JSON.parse(e)}catch(t){if(t instanceof SyntaxError)return a({},A);throw t}})(),t=R(a(a({},A),e));return V(t),t})());let re,ie;var le=()=>{};const ue={data:()=>({isPaused:!0,areSettingsOpen:!1,showUpdateAvailable:!1,focusDurationSetting:ae.durations.focus/60,shortBreakDurationSetting:ae.durations.shortBreak/60,longBreakDurationSetting:ae.durations.longBreak/60}),computed:{timeLeftString(){var e=Math.floor(ae.timeLeft/60/60);return[e||null,Math.floor(ae.timeLeft/60%60),Math.floor(ae.timeLeft%60)].filter((e=>null!==e)).map(ne).join(":")}},methods:{updateDocumentTitle(){let e="Pomodo";this.isPaused||(e=this.timeLeftString+" | "+e),document.title=e},switchTo(e){this.isPaused=!0,this.stopTimer(),ae.mode=e,ae.timeLeft=ae.durations[e],V(ae)},buttonClass:e=>e===ae.mode?"filled":"",toggle(){this.isPaused=!this.isPaused,this.isPaused?this.stopTimer():this.startTimer()},timerClicked(){this.toggle(),this.setupNotifications()},onTick(){if(!this.isPaused){let e=Date.now()-ie;if(ae.timeLeft=ae.timeLeft-e/1e3,ie+=e,ae.timeLeft<=0)if("focus"===ae.mode){ae.streak.length+=1,ae.streak.time=Date.now();const e=ae.streak.length%ae.streaksForLongBreak==0;this.switchTo(e?"longBreak":"shortBreak"),le("Hey, it's time for a break","Relax and collect more energy to work productively during the next pomodoro")}else this.switchTo("focus"),le("Hey, the break is over","It's time to focus on your tasks");this.updateDocumentTitle(),V(ae)}this.isPaused&&this.stopTimer()},startTimer(){null==re||re.postMessage("stopTimer"),ie=Date.now(),null==re||re.postMessage("startTimer")},stopTimer(){null==re||re.postMessage("stopTimer"),this.updateDocumentTitle()},setDuration(e,t){isNaN(t)||(t>=1&&t<=120&&(e===ae.mode&&ae.timeLeft===ae.durations[e]&&this.isPaused&&(ae.timeLeft=60*+t),ae.durations[e]=60*+Math.round(t)),this[e+"DurationSetting"]=ae.durations[e]/60,V(ae))},reloadPage(){window.location.reload()},async setupNotifications(){"default"===Notification.permission&&await Notification.requestPermission(),"granted"===Notification.permission&&(le=(e,t)=>{new Notification(e,{body:t,icon:"/favicon.ico",sound:"default"})})}},mounted(){(async function({onUpdateAvailable:e}){if("serviceWorker"in navigator){const t=await navigator.serviceWorker.register(E);console.log("Service worker registered successfully! Scope: "+t.scope),t.addEventListener("updatefound",(()=>{const o=t.installing;null!=o&&o.addEventListener("statechange",(()=>{"installed"===o.state&&(navigator.serviceWorker.controller?(e(),console.log("New content is available")):console.log("Content is cached for offline use"))}))})),navigator.serviceWorker.addEventListener("controllerchange",(()=>{window.location.reload()}))}})({onUpdateAvailable:()=>{this.showUpdateAvailable=!0}}).catch(console.error),re=W(),re.addEventListener("message",(e=>{switch(e.data){case"tick":this.onTick();break;default:console.error("Unknown message: "+e.data)}}))}};T(Object.assign(ue,{setup:function(e){return(e,t)=>(r(),i(u,null,[l("header",q,[H,l("div",J,[l("button",{type:"button",class:m(e.buttonClass("focus")),onClick:t[0]||(t[0]=t=>e.switchTo("focus"))}," Focus ",2),l("button",{type:"button",class:m(e.buttonClass("shortBreak")),onClick:t[1]||(t[1]=t=>e.switchTo("shortBreak"))}," Short Break ",2),l("button",{type:"button",class:m(e.buttonClass("longBreak")),onClick:t[2]||(t[2]=t=>e.switchTo("longBreak"))}," Long Break ",2)])]),h(O,{time:e.timeLeftString,isPaused:e.isPaused,onClick:t[3]||(t[3]=t=>e.timerClicked())},null,8,["time","isPaused"]),l("button",{type:"button",class:"settings-button",onClick:t[4]||(t[4]=t=>e.areSettingsOpen=!0)}," Settings "),h(C,{isOpen:e.areSettingsOpen,onClose:t[11]||(t[11]=t=>e.areSettingsOpen=!1)},{header:k((()=>[K])),body:k((()=>[l("div",z,[l("div",G,[Q,B(l("input",{type:"number",min:"10",max:"120","onUpdate:modelValue":t[5]||(t[5]=e=>P(focusDurationSetting)?focusDurationSetting.value=e:null),onChange:t[6]||(t[6]=t=>e.setDuration("focus",+t.target.value))},null,544),[[D,e.focusDurationSetting]])]),l("div",X,[Y,B(l("input",{type:"number",min:"5",max:"15","onUpdate:modelValue":t[7]||(t[7]=e=>P(shortBreakDurationSetting)?shortBreakDurationSetting.value=e:null),onChange:t[8]||(t[8]=t=>e.setDuration("shortBreak",+t.target.value))},null,544),[[D,e.shortBreakDurationSetting]])]),l("div",Z,[ee,B(l("input",{type:"number",min:"10",max:"60","onUpdate:modelValue":t[9]||(t[9]=e=>P(longBreakDurationSetting)?longBreakDurationSetting.value=e:null),onChange:t[10]||(t[10]=t=>e.setDuration("longBreak",+t.target.value))},null,544),[[D,e.longBreakDurationSetting]])])])])),_:1},8,["isOpen"]),h(C,{isOpen:e.showUpdateAvailable,onClose:t[13]||(t[13]=t=>e.showUpdateAvailable=!1)},{header:k((()=>[te])),body:k((()=>[l("div",oe,[se,l("button",{type:"button",class:"filled",onClick:t[12]||(t[12]=t=>e.reloadPage())}," Reload ")])])),_:1},8,["isOpen"])],64))}})).mount("#app");
